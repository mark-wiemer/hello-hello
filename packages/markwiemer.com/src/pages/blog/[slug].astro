---
import Layout from "@/layouts/Layout.astro";

/**
 * Magic function used by Astro.
 * https://docs.astro.build/en/guides/routing/#dynamic-routes
 */
export async function getStaticPaths() {
  // Get all files from src/pages/blog/content
  const glob = import.meta.glob("./content/*.mdx", { eager: true });

  // path: e.g. './content/2024-10-08 months-without-music.mdx'
  // module: MDX module
  const paths = Object.entries(glob).map(([path, module]) => {
    // Extract filename from path:
    /** e.g. '2024-10-08 months-without-music' */
    const filename = path.split("/").pop()?.replace(".mdx", "") || "";
    // Extract slug from filename:
    /** e.g. 'months-without-music' */
    const slug = filename.split(" ").slice(1).join("-");

    return {
      /** Variable must have this exact name to match filename `[slug].astro` */
      params: { slug: slug },
      props: {
        module,
        filename,
      },
    };
  });

  return paths;
}

interface Props {
  module: any;
}

const { module } = Astro.props;
let { default: Content, frontmatter } = module;
frontmatter ??= {};
/* todo handle "orginally posted on Medium.com" stuff */
const { postTitle, postDate, postTime, lastUpdated, postType } = frontmatter;
let preface = `${postDate}${postTime ? `, ${postTime}.` : "."}`;

preface += lastUpdated ? ` Last updated ${lastUpdated}.` : "";
preface +=
  postType === "notes"
    ? ` These are personal notes, subject to change. None of this is legal advice.`
    : "";
---

<Layout pageTitle={postTitle}>
  <h1>{postTitle}</h1>
  <p>{preface}</p>
  <Content />
</Layout>
