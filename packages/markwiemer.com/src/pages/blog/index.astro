---
import Layout from "@/layouts/Layout.astro";

const glob = import.meta.glob("./content/*.mdx", { eager: true });

type PostListItem = {
  postDate: string;
  postTime: string | undefined;
  postTitle: string;
  postType: string;
  lastUpdated: string | undefined;
  /** Whether to list the post in the index and home page */
  listed: boolean | undefined;
  slug: string;
};

const posts: PostListItem[] = Object.entries(glob)
  .map(([path, module]: [string, any]) => {
    // path === './content/2024-10-08 months-without-music.mdx'
    // filename === '2024-10-08 months-without-music'
    const filename = path.split("/").pop()?.replace(".mdx", "") || "";
    // slug === 'months-without-music'
    const slug = filename.split(" ").slice(1).join("-");
    const listed = module?.frontmatter.listed ?? true;
    return { ...module?.frontmatter, slug, listed };
  })
  .filter((post) => post.postDate && post.slug && !!post.listed)
  .sort((a, b) => b.postDate.localeCompare(a.postDate));
---

<Layout pageTitle="Blog">
  <h1>Blog</h1>
  <p>
    I used to post exclusively on medium.com, but I'm slowly moving posts to this site. Some of the
    newest posts are only available here, but I plan to automatically sync them with Medium
    eventually.
  </p>
  <ul>
    {
      posts.map((post) => (
        <li>
          {post.postType === "notes" ? `${post.postDate} (notes): ` : `${post.postDate}: `}
          <a href={`/blog/${post.slug}`}>{post.postTitle}</a>
          {post.lastUpdated ? ` (last updated ${post.lastUpdated})` : ""}
        </li>
      ))
    }
    <li>
      Other posts: <a href="https://markwiemer.medium.com">markwiemer.medium.com</a>
    </li>
  </ul>
</Layout>
